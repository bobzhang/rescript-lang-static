(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[55125],{17375:function(e,t,n){"use strict";function r(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}n.d(t,{Z:function(){return r}})},86450:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var r=n(17375),a=n(96156),o=(n(67294),n(3905));function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s,p=(s="CodeTab",function(e){return console.warn("Component "+s+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",l({},e))}),c={};function u(e){var t=e.components,n=(0,r.Z)(e,["components"]);return(0,o.kt)("wrapper",l(l(l({},c),n),{},{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",l({},{id:"router"}),"Router"),(0,o.kt)("p",null,"RescriptReact comes with a router! We've leveraged the language and library features in order to create a router that's:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The simplest, thinnest possible."),(0,o.kt)("li",{parentName:"ul"},"Easily pluggable anywhere into your existing code."),(0,o.kt)("li",{parentName:"ul"},"Performant and tiny.")),(0,o.kt)("h2",l({},{id:"how-does-it-work"}),"How does it work?"),(0,o.kt)("p",null,"The available methods are listed here:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"RescriptReactRouter.push(string)"),": takes a new path and update the URL."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"RescriptReactRouter.replace(string)"),": like ",(0,o.kt)("inlineCode",{parentName:"li"},"push"),", but replaces the current URL."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"RescriptReactRouter.watchUrl(f)"),": start watching for URL changes. Returns a subscription token. Upon url change, calls the callback and passes it the ",(0,o.kt)("inlineCode",{parentName:"li"},"RescriptReactRouter.url")," record."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"RescriptReactRouter.unwatchUrl(watcherID)"),": stop watching for URL changes."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"RescriptReactRouter.dangerouslyGetInitialUrl()"),": get ",(0,o.kt)("inlineCode",{parentName:"li"},"url")," record outside of ",(0,o.kt)("inlineCode",{parentName:"li"},"watchUrl"),". Described later."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"RescriptReactRouter.useUrl(~serverUrl)"),": returns the ",(0,o.kt)("inlineCode",{parentName:"li"},"url")," record inside a component.")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"If you want to know more about the low level details on how the router interface is implemented, refer to the ",(0,o.kt)("a",l({parentName:"p"},{href:"https://github.com/rescript-lang/rescript-react/blob/master/src/RescriptReactRouter.res"}),"RescriptReactRouter implementation"),".")),(0,o.kt)("h2",l({},{id:"match-a-route"}),"Match a Route"),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"There's no API"),"! ",(0,o.kt)("inlineCode",{parentName:"p"},"watchUrl")," gives you back a ",(0,o.kt)("inlineCode",{parentName:"p"},"url")," record of the following shape:"),(0,o.kt)(p,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,o.kt)("pre",null,(0,o.kt)("code",l({parentName:"pre"},{className:"language-res",metastring:"prelude",prelude:!0}),'type url = {\n  /* path takes window.location.pathname, like "/book/title/edit" and turns it into `list{"book", "title", "edit"}` */\n  path: list<string>,\n  /* the url\'s hash, if any. The # symbol is stripped out for you */\n  hash: string,\n  /* the url\'s query params, if any. The ? symbol is stripped out for you */\n  search: string\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",l({parentName:"pre"},{className:"language-js"}),"// Empty output\n"))),(0,o.kt)("p",null,"So the url ",(0,o.kt)("inlineCode",{parentName:"p"},"www.hello.com/book/10/edit?name=Jane#author")," is given back as:"),(0,o.kt)(p,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,o.kt)("pre",null,(0,o.kt)("code",l({parentName:"pre"},{className:"language-res",metastring:"prelude",prelude:!0}),'{\n  path: list{"book", "10", "edit"},\n  hash: "author",\n  search: "name=Jane"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",l({parentName:"pre"},{className:"language-js"}),"// Empty output\n"))),(0,o.kt)("h2",l({},{id:"basic-example"}),"Basic Example"),(0,o.kt)("p",null,"Let's start with a first example to see how a ReScript React Router looks like:"),(0,o.kt)(p,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,o.kt)("pre",null,(0,o.kt)("code",l({parentName:"pre"},{className:"language-res"}),'// App.res\n@react.component\nlet make = () => {\n  let url = RescriptReactRouter.useUrl()\n  \n  switch url.path {\n    | list{"user", id} => <User id />\n    | list{} => <Home/>\n    | _ => <PageNotFound/>\n  }\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",l({parentName:"pre"},{className:"language-js"}),'import * as React from "react";\nimport * as User from "./User.bs.js";\nimport * as RescriptReactRouter from "@rescript/react/src/RescriptReactRouter.bs.js";\nimport * as Home from "./Home.bs.js";\nimport * as NotFound from "./NotFound.bs.js";\n\nfunction App(Props) {\n  var url = RescriptReactRouter.useUrl(undefined, undefined);\n  var match = url.path;\n  if (!match) {\n    return React.createElement(Home.make, {});\n  }\n  if (match.hd === "user") {\n    var match$1 = match.tl;\n    if (match$1 && !match$1.tl) {\n      return React.createElement(User.make, {\n                  id: match$1.hd\n                });\n    }\n    \n  }\n  return React.createElement(NotFound.make, {});\n}\n\nvar make = App;\n\nexport {\n  make ,\n  \n}\n'))),(0,o.kt)("h2",l({},{id:"directly-get-a-route"}),"Directly Get a Route"),(0,o.kt)("p",null,"In one specific occasion, you might want to take hold of a ",(0,o.kt)("inlineCode",{parentName:"p"},"url")," record outside of ",(0,o.kt)("inlineCode",{parentName:"p"},"watchUrl"),". For example, if you've put ",(0,o.kt)("inlineCode",{parentName:"p"},"watchUrl")," inside a component's ",(0,o.kt)("inlineCode",{parentName:"p"},"didMount")," so that a URL change triggers a component state change, you might also want the initial state to be dictated by the URL."),(0,o.kt)("p",null,"In other words, you'd like to read from the ",(0,o.kt)("inlineCode",{parentName:"p"},"url")," record once at the beginning of your app logic. We expose ",(0,o.kt)("inlineCode",{parentName:"p"},"dangerouslyGetInitialUrl()")," for this purpose."),(0,o.kt)("p",null,'Note: the reason why we label it as "dangerous" is to remind you not to read this ',(0,o.kt)("inlineCode",{parentName:"p"},"url")," in any arbitrary component's e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"render"),", since that information might be out of date if said component doesn't also contain a ",(0,o.kt)("inlineCode",{parentName:"p"},"watchUrl")," subscription that re-renders the component when the URL changes. Aka, please only use ",(0,o.kt)("inlineCode",{parentName:"p"},"dangerouslyGetInitialUrl")," alongside ",(0,o.kt)("inlineCode",{parentName:"p"},"watchUrl"),"."),(0,o.kt)("h2",l({},{id:"push-a-new-route"}),"Push a New Route"),(0,o.kt)("p",null,"From anywhere in your app, just call e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},'RescriptReactRouter.push("/books/10/edit#validated")'),". This will trigger a URL change (without a page refresh) and ",(0,o.kt)("inlineCode",{parentName:"p"},"watchUrl"),"'s callback will be called again."),(0,o.kt)("p",null,"We might provide better facilities for typed routing + payload carrying in the future!"),(0,o.kt)("p",null,'Note: because of browser limitations, changing the URL through JavaScript (aka pushState) cannot be detected. The solution is to change the URL then fire a "popState" event. This is what Router.push does, and what the event watchUrl listens to.\nSo if, for whatever reason (e.g. incremental migration), you want to update the URL outside of ',(0,o.kt)("inlineCode",{parentName:"p"},"RescriptReactRouter.push"),", just do ",(0,o.kt)("inlineCode",{parentName:"p"},"window.dispatchEvent(new Event('popState'))"),"."),(0,o.kt)("h2",l({},{id:"design-decisions"}),"Design Decisions"),(0,o.kt)("p",null,"We always strive to lower the performance and learning overhead in RescriptReact, and our router design's no different. The entire implementation, barring browser features detection, is around 20 lines. The design might seem obvious in retrospect, but to arrive here, we had to dig back into ReactJS internals & future proposals to make sure we understood the state update mechanisms, the future context proposal, lifecycle ordering, etc. and reject some bad API designs along the way. It's nice to arrive at such an obvious solution!"),(0,o.kt)("p",null,"The API also doesn't dictate whether matching on a route should return a component, a state update, or a side-effect. Flexible enough to slip into existing apps."),(0,o.kt)("p",null,"Performance-wise, a JavaScript-like API tends to use a JS object of route string -> callback. We eschewed that in favor of pattern-matching, since the latter in Rescript does not allocate memory, and is compiled to a fast jump table in C++ (through the JS JIT). In fact, the only allocation in the router matching is the creation of the url record!"))}u.isMDXComponent=!0,u.frontmatter={title:"Router",description:"Basic concepts for navigation and routing in ReScript & React",canonical:"/docs/react/latest/router",__ghEditHref:"https://github.com/reason-association/rescript-lang.org/blob/master/pages/docs/react/latest/router.mdx"}},35743:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/react/latest/router",function(){return n(86450)}])}},function(e){e.O(0,[92888,49774,40179],(function(){return t=35743,e(e.s=t);var t}));var t=e.O();_N_E=t}]);