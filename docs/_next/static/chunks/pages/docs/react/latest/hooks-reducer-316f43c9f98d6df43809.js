(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[14116],{17375:function(t,e,n){"use strict";function o(t,e){if(null==t)return{};var n,o,a=function(t,e){if(null==t)return{};var n,o,a={},r=Object.keys(t);for(o=0;o<r.length;o++)n=r[o],e.indexOf(n)>=0||(a[n]=t[n]);return a}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(o=0;o<r.length;o++)n=r[o],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}n.d(e,{Z:function(){return o}})},7136:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return p}});var o=n(17375),a=n(96156),r=(n(67294),n(3905));function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){(0,a.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var s=function(t){return function(e){return console.warn("Component "+t+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",i({},e))}},u=s("Intro"),d=s("CodeTab"),l={};function p(t){var e=t.components,n=(0,o.Z)(t,["components"]);return(0,r.kt)("wrapper",i(i(i({},l),n),{},{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",i({},{id:"usereducer"}),"useReducer"),(0,r.kt)(u,{mdxType:"Intro"},(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"React.useReducer")," helps you express your state in an action / reducer pattern.")),(0,r.kt)("h2",i({},{id:"usage"}),"Usage"),(0,r.kt)(d,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,r.kt)("pre",null,(0,r.kt)("code",i({parentName:"pre"},{className:"language-res"}),"let (state, dispatch) = React.useReducer(reducer, initialState)\n")),(0,r.kt)("pre",null,(0,r.kt)("code",i({parentName:"pre"},{className:"language-js"}),"var match = React.useReducer(reducer, initialState);\n"))),(0,r.kt)("p",null,"An alternative to ",(0,r.kt)("a",i({parentName:"p"},{href:"./hooks-state"}),"useState"),". Accepts a reducer of type ",(0,r.kt)("inlineCode",{parentName:"p"},"(state, action) => newState"),", and returns the current ",(0,r.kt)("inlineCode",{parentName:"p"},"state")," paired with a ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch")," function ",(0,r.kt)("inlineCode",{parentName:"p"},"(action) => unit"),". "),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"React.useReducer")," is usually preferable to ",(0,r.kt)("inlineCode",{parentName:"p"},"useState")," when you have complex state logic that involves multiple sub-values or when the next state depends on the previous one. ",(0,r.kt)("inlineCode",{parentName:"p"},"useReducer")," also lets you optimize performance for components that trigger deep updates because you can pass dispatch down instead of callbacks."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note:")," You will notice that the action / reducer pattern works especially well in ReScript due to its ",(0,r.kt)("a",i({parentName:"p"},{href:"/docs/manual/latest/record"}),"immutable records"),", ",(0,r.kt)("a",i({parentName:"p"},{href:"/docs/manual/latest/variant"}),"variants")," and ",(0,r.kt)("a",i({parentName:"p"},{href:"/docs/manual/latest/pattern-matching-destructuring"}),"pattern matching")," features for easy expression of your action and state transitions."),(0,r.kt)("h2",i({},{id:"examples"}),"Examples"),(0,r.kt)("h3",i({},{id:"counter-example-with-reactusereducer"}),"Counter Example with ",(0,r.kt)("inlineCode",{parentName:"h3"},"React.useReducer")),(0,r.kt)(d,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,r.kt)("pre",null,(0,r.kt)("code",i({parentName:"pre"},{className:"language-res"}),'// Counter.res\n\ntype action = Inc | Dec\ntype state = {count: int}\n\nlet reducer = (state, action) => {\n  switch action {\n  | Inc => {count: state.count + 1}\n  | Dec => {count: state.count - 1}\n  }\n}\n\n@react.component\nlet make = () => {\n  let (state, dispatch) = React.useReducer(reducer, {count: 0})\n\n  <>\n    {React.string("Count:" ++ Belt.Int.toString(state.count))}\n    <button onClick={(_) => dispatch(Dec)}> {React.string("-")} </button>\n    <button onClick={(_) => dispatch(Inc)}> {React.string("+")} </button>\n  </>\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",i({parentName:"pre"},{className:"language-js"}),'function reducer(state, action) {\n  if (action) {\n    return {\n            count: state.count - 1 | 0\n          };\n  } else {\n    return {\n            count: state.count + 1 | 0\n          };\n  }\n}\n\nfunction Counter(Props) {\n  var match = React.useReducer(reducer, {\n        count: 0\n      });\n  var dispatch = match[1];\n  return React.createElement(React.Fragment, undefined, "Count:" + String(match[0].count), React.createElement("button", {\n                  onClick: (function (param) {\n                      return Curry._1(dispatch, /* Dec */1);\n                    })\n                }, "-"), React.createElement("button", {\n                  onClick: (function (param) {\n                      return Curry._1(dispatch, /* Inc */0);\n                    })\n                }, "+"));\n}\n'))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"React guarantees that dispatch function identity is stable and won\u2019t change on re-renders. This is why it\u2019s safe to omit from the useEffect or useCallback dependency list.")),(0,r.kt)("h3",i({},{id:"basic-todo-list-app-with-more-complex-actions"}),"Basic Todo List App with More Complex Actions"),(0,r.kt)("p",null,"You can leverage the full power of variants to express actions with data payloads to parametrize your state transitions:"),(0,r.kt)(d,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,r.kt)("pre",null,(0,r.kt)("code",i({parentName:"pre"},{className:"language-res"}),'// TodoApp.res\n\ntype todo = {\n  id: int,\n  content: string,\n  completed: bool,\n}\n\ntype action =\n  | AddTodo(string)\n  | RemoveTodo(int)\n  | ToggleTodo(int)\n\ntype state = {\n  todos: array<todo>,\n  nextId: int,\n}\n\nlet reducer = (state, action) =>\n  switch action {\n  | AddTodo(content) =>\n    let todos = Js.Array2.concat(\n      state.todos,\n      [{id: state.nextId, content: content, completed: false}],\n    )\n    {todos: todos, nextId: state.nextId + 1}\n  | RemoveTodo(id) =>\n    let todos = Js.Array2.filter(state.todos, todo => todo.id !== id)\n    {...state, todos: todos}\n  | ToggleTodo(id) =>\n    let todos = Belt.Array.map(state.todos, todo =>\n      if todo.id === id {\n        {\n          ...todo,\n          completed: !todo.completed,\n        }\n      } else {\n        todo\n      }\n    )\n    {...state, todos: todos}\n  }\n\nlet initialTodos = [{id: 1, content: "Try ReScript & React", completed: false}]\n\n@react.component\nlet make = () => {\n  let (state, dispatch) = React.useReducer(\n    reducer,\n    {todos: initialTodos, nextId: 2},\n  )\n\n  let todos = Belt.Array.map(state.todos, todo =>\n    <li>\n      {React.string(todo.content)}\n      <button onClick={_ => dispatch(RemoveTodo(todo.id))}>\n        {React.string("Remove")}\n      </button>\n      <input\n        type_="checkbox"\n        checked=todo.completed\n        onChange={_ => dispatch(ToggleTodo(todo.id))}\n      />\n    </li>\n  )\n\n  <> <h1> {React.string("Todo List:")} </h1> <ul> {React.array(todos)} </ul> </>\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",i({parentName:"pre"},{className:"language-js"}),'function reducer(state, action) {\n  switch (action.TAG | 0) {\n    case /* AddTodo */0 :\n        var todos = state.todos.concat([{\n                id: state.nextId,\n                content: action._0,\n                completed: false\n              }]);\n        return {\n                todos: todos,\n                nextId: state.nextId + 1 | 0\n              };\n    case /* RemoveTodo */1 :\n        var id = action._0;\n        var todos$1 = state.todos.filter(function (todo) {\n              return todo.id !== id;\n            });\n        return {\n                todos: todos$1,\n                nextId: state.nextId\n              };\n    case /* ToggleTodo */2 :\n        var id$1 = action._0;\n        var todos$2 = Belt_Array.map(state.todos, (function (todo) {\n                if (todo.id === id$1) {\n                  return {\n                          id: todo.id,\n                          content: todo.content,\n                          completed: !todo.completed\n                        };\n                } else {\n                  return todo;\n                }\n              }));\n        return {\n                todos: todos$2,\n                nextId: state.nextId\n              };\n    \n  }\n}\n\nvar initialTodos = [{\n    id: 1,\n    content: "Try ReScript & React",\n    completed: false\n  }];\n\nfunction TodoApp(Props) {\n  var match = React.useReducer(reducer, {\n        todos: initialTodos,\n        nextId: 2\n      });\n  var dispatch = match[1];\n  var todos = Belt_Array.map(match[0].todos, (function (todo) {\n          return React.createElement("li", undefined, todo.content, React.createElement("button", {\n                          onClick: (function (param) {\n                              return Curry._1(dispatch, {\n                                          TAG: /* RemoveTodo */1,\n                                          _0: todo.id\n                                        });\n                            })\n                        }, "Remove"), React.createElement("input", {\n                          checked: todo.completed,\n                          type: "checkbox",\n                          onChange: (function (param) {\n                              return Curry._1(dispatch, {\n                                          TAG: /* ToggleTodo */2,\n                                          _0: todo.id\n                                        });\n                            })\n                        }));\n        }));\n  return React.createElement(React.Fragment, undefined, React.createElement("h1", undefined, "Todo List:"), React.createElement("ul", undefined, todos));\n}\n'))),(0,r.kt)("h2",i({},{id:"lazy-initialization"}),"Lazy Initialization"),(0,r.kt)(d,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,r.kt)("pre",null,(0,r.kt)("code",i({parentName:"pre"},{className:"language-res"}),"let (state, dispatch) =\n  React.useReducerWithMapState(reducer, initialState, initial)\n")),(0,r.kt)("pre",null,(0,r.kt)("code",i({parentName:"pre"},{className:"language-js"}),"var match = React.useReducer(reducer, initialState, init);\n"))),(0,r.kt)("p",null,"You can also create the ",(0,r.kt)("inlineCode",{parentName:"p"},"initialState")," lazily. To do this, you can use ",(0,r.kt)("inlineCode",{parentName:"p"},"React.useReducerWithMapState")," and pass an ",(0,r.kt)("inlineCode",{parentName:"p"},"init")," function as the third argument. The initial state will be set to ",(0,r.kt)("inlineCode",{parentName:"p"},"init(initialState)"),"."),(0,r.kt)("p",null,"It lets you extract the logic for calculating the initial state outside the reducer. This is also handy for resetting the state later in response to an action:"),(0,r.kt)(d,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,r.kt)("pre",null,(0,r.kt)("code",i({parentName:"pre"},{className:"language-res"}),'// Counter.res\n\ntype action = Inc | Dec | Reset(int)\ntype state = {count: int}\n\nlet init = initialCount => {\n  {count: initialCount}\n}\n\nlet reducer = (state, action) => {\n  switch action {\n  | Inc => {count: state.count + 1}\n  | Dec => {count: state.count - 1}\n  | Reset(count) => init(count)\n  }\n}\n\n@react.component\nlet make = (~initialCount: int) => {\n  let (state, dispatch) = React.useReducerWithMapState(\n    reducer,\n    initialCount,\n    init,\n  )\n\n  <>\n    {React.string("Count:" ++ Belt.Int.toString(state.count))}\n    <button onClick={_ => dispatch(Dec)}> {React.string("-")} </button>\n    <button onClick={_ => dispatch(Inc)}> {React.string("+")} </button>\n  </>\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",i({parentName:"pre"},{className:"language-js"}),'function init(initialCount) {\n  return {\n          count: initialCount\n        };\n}\n\nfunction reducer(state, action) {\n  if (typeof action === "number") {\n    if (action !== 0) {\n      return {\n              count: state.count - 1 | 0\n            };\n    } else {\n      return {\n              count: state.count + 1 | 0\n            };\n    }\n  } else {\n    return {\n            count: action._0\n          };\n  }\n}\n\nfunction Counter(Props) {\n  var initialCount = Props.initialCount;\n  var match = React.useReducer(reducer, initialCount, init);\n  var dispatch = match[1];\n  return React.createElement(React.Fragment, undefined, "Count:" + String(match[0].count), React.createElement("button", {\n                  onClick: (function (param) {\n                      return Curry._1(dispatch, /* Dec */1);\n                    })\n                }, "-"), React.createElement("button", {\n                  onClick: (function (param) {\n                      return Curry._1(dispatch, /* Inc */0);\n                    })\n                }, "+"));\n}\n'))))}p.isMDXComponent=!0,p.frontmatter={title:"useReducer Hook",description:"Details about the useReducer React hook in ReScript",canonical:"/docs/react/latest/hooks-reducer",__ghEditHref:"https://github.com/reason-association/rescript-lang.org/blob/master/pages/docs/react/latest/hooks-reducer.mdx"}},74987:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/react/latest/hooks-reducer",function(){return n(7136)}])}},function(t){t.O(0,[92888,49774,40179],(function(){return e=74987,t(t.s=e);var e}));var e=t.O();_N_E=e}]);