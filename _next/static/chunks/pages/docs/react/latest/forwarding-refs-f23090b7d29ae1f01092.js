(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[41726],{22122:function(e,n,t){"use strict";function r(){return(r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}t.d(n,{Z:function(){return r}})},17375:function(e,n,t){"use strict";function r(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}t.d(n,{Z:function(){return r}})},3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return s},kt:function(){return d}});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"===typeof e?e(n):i(i({},n),e)),t},s=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},f=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),f=c(t),d=a,m=f["".concat(l,".").concat(d)]||f[d]||u[d]||o;return t?r.createElement(m,i(i({ref:n},s),{},{components:t})):r.createElement(m,i({ref:n},s))}));function d(e,n){var t=arguments,a=n&&n.mdxType;if("string"===typeof e||a){var o=t.length,i=new Array(o);i[0]=f;var p={};for(var l in n)hasOwnProperty.call(n,l)&&(p[l]=n[l]);p.originalType=e,p.mdxType="string"===typeof e?e:a,i[1]=p;for(var c=2;c<o;c++)i[c]=t[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}f.displayName="MDXCreateElement"},96086:function(e){"use strict";var n=Object.assign.bind(Object);e.exports=n,e.exports.default=e.exports},63501:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return u}});var r=t(22122),a=t(17375),o=t(67294),i=t(3905),p=(o.createElement,function(e){return function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",n)}}),l=p("Intro"),c=p("CodeTab"),s={};function u(e){var n=e.components,t=(0,a.Z)(e,["components"]);return(0,i.kt)("wrapper",(0,r.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"forwarding-refs"},"Forwarding Refs"),(0,i.kt)(l,{mdxType:"Intro"},(0,i.kt)("p",null,"Ref forwarding is a technique for automatically passing a ",(0,i.kt)("a",(0,r.Z)({parentName:"p"},{href:"./refs-and-the-dom"}),"React.ref")," through a component to one of its children. This is typically not necessary for most components in the application. However, it can be useful for some kinds of components, especially in reusable component libraries. The most common scenarios are described below.")),(0,i.kt)("h2",{id:"why-ref-forwarding"},"Why Ref Forwarding?"),(0,i.kt)("p",null,"Consider a FancyButton component that renders the native button DOM element:"),(0,i.kt)("pre",null,(0,i.kt)("code",(0,r.Z)({parentName:"pre"},{className:"language-res"}),'// FancyButton.res\n\n@react.component\nlet make = (~children) => {\n  <button className="FancyButton">\n    children\n  </button>\n}\n')),(0,i.kt)("p",null,"React components hide their implementation details, including their rendered output. Other components using FancyButton ",(0,i.kt)("strong",{parentName:"p"},"usually will not need")," to obtain a ref to the inner button DOM element. This is good because it prevents components from relying on each other\u2019s DOM structure too much."),(0,i.kt)("p",null,"Although such encapsulation is desirable for application-level components like ",(0,i.kt)("inlineCode",{parentName:"p"},"FeedStory")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"Comment"),", it can be inconvenient for highly reusable \u201cleaf\u201d components like ",(0,i.kt)("inlineCode",{parentName:"p"},"FancyButton")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"MyTextInput"),". These components tend to be used throughout the application in a similar manner as a regular DOM button and input, and accessing their DOM nodes may be unavoidable for managing focus, selection, or animations."),(0,i.kt)("p",null,"There are currently two strategies on forwarding refs through a component. In ReScript and React we strongly recommend ",(0,i.kt)("strong",{parentName:"p"},"passing your ref as a prop"),", but there is also a dedicated API called ",(0,i.kt)("inlineCode",{parentName:"p"},"React.forwardRef"),"."),(0,i.kt)("p",null,"We will discuss both methods in this document."),(0,i.kt)("h2",{id:"forward-refs-via-props"},"Forward Refs via Props"),(0,i.kt)("p",null,"A ",(0,i.kt)("inlineCode",{parentName:"p"},"React.ref")," can be passed down like any other prop. The component will take care of forwarding the ref to the right DOM element."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"No new concepts to learn!")),(0,i.kt)("p",null,"In the example below, ",(0,i.kt)("inlineCode",{parentName:"p"},"FancyInput")," defines a prop ",(0,i.kt)("inlineCode",{parentName:"p"},"inputRef")," that will be forwarded to its ",(0,i.kt)("inlineCode",{parentName:"p"},"input")," element:"),(0,i.kt)("pre",null,(0,i.kt)("code",(0,r.Z)({parentName:"pre"},{className:"language-res"}),'// App.res\n\nmodule FancyInput = {\n  @react.component\n  let make = (~children, ~inputRef: ReactDOM.domRef) =>\n    <div> <input type_="text" ref=inputRef /> children </div>\n}\n\n@send external focus: Dom.element => unit = "focus"\n\n@react.component\nlet make = () => {\n  let input = React.useRef(Js.Nullable.null)\n\n  let focusInput = () =>\n    input.current\n    ->Js.Nullable.toOption\n    ->Belt.Option.forEach(input => input->focus)\n\n  let onClick = _ => focusInput()\n\n  <div>\n    <FancyInput inputRef={ReactDOM.Ref.domRef(input)}>\n      <button onClick> {React.string("Click to focus")} </button>\n    </FancyInput>\n  </div>\n}\n')),(0,i.kt)("p",null,"We use the ",(0,i.kt)("inlineCode",{parentName:"p"},"ReactDOM.domRef")," type to represent our ",(0,i.kt)("inlineCode",{parentName:"p"},"inputRef"),". We pass our ref in the exact same manner as we'd do a DOM ",(0,i.kt)("inlineCode",{parentName:"p"},"ref")," attribute (",(0,i.kt)("inlineCode",{parentName:"p"},"<input ref={ReactDOM.Ref.domRef(myRef)} />"),")."),(0,i.kt)("h2",{id:"discouraged-reactforwardref"},"[Discouraged]"," React.forwardRef"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note:")," We discourage this method since it ",(0,i.kt)("a",(0,r.Z)({parentName:"p"},{href:"https://twitter.com/dan_abramov/status/1173372190395445251"}),"will likely go away")," at some point, and doesn't yield any obvious advantages over the previously mentioned ref prop passing."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"React.forwardRef"),' offers a way to "emulate a ',(0,i.kt)("inlineCode",{parentName:"p"},"ref"),' prop" within custom components. Internally the component will forward the passed ',(0,i.kt)("inlineCode",{parentName:"p"},"ref")," value to the target DOM element instead."),(0,i.kt)("p",null,"This is how the previous example would look like with the ",(0,i.kt)("inlineCode",{parentName:"p"},"React.forwardRef")," approach:"),(0,i.kt)(c,{labels:["ReScript","JS Output"],mdxType:"CodeTab"},(0,i.kt)("pre",null,(0,i.kt)("code",(0,r.Z)({parentName:"pre"},{className:"language-res"}),'// App.res\n\nmodule FancyInput = {\n  @react.component\n  let make = React.forwardRef((~className=?, ~children, ref_) =>\n    <div>\n      <input\n        type_="text"\n        ?className\n        ref=?{Js.Nullable.toOption(ref_)->Belt.Option.map(\n          ReactDOMRe.Ref.domRef,\n        )}\n      />\n      children\n    </div>\n  )\n}\n\n@send external focus: Dom.element => unit = "focus"\n\n@react.component\nlet make = () => {\n  let input = React.useRef(Js.Nullable.null)\n\n  let focusInput = () =>\n    input.current\n    ->Js.Nullable.toOption\n    ->Belt.Option.forEach(input => input->focus)\n\n  let onClick = _ => focusInput()\n\n  <div>\n    <FancyInput className="fancy" ref=input>\n      <button onClick> {React.string("Click to focus")} </button>\n    </FancyInput>\n  </div>\n}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",(0,r.Z)({parentName:"pre"},{className:"language-js"}),'var React = require("react");\nvar Belt_Option = require("./stdlib/belt_Option.js");\nvar Caml_option = require("./stdlib/caml_option.js");\n\nvar make = React.forwardRef(function (Props, ref_) {\n      var className = Props.className;\n      var children = Props.children;\n      var tmp = {\n        type: "text"\n      };\n      var tmp$1 = Belt_Option.map((ref_ == null) ? undefined : Caml_option.some(ref_), (function (prim) {\n              return prim;\n            }));\n      if (tmp$1 !== undefined) {\n        tmp.ref = Caml_option.valFromOption(tmp$1);\n      }\n      if (className !== undefined) {\n        tmp.className = Caml_option.valFromOption(className);\n      }\n      return React.createElement("div", undefined, React.createElement("input", tmp), children);\n    });\n\nvar FancyInput = {\n  make: make\n};\n\nfunction App(Props) {\n  var input = React.useRef(null);\n  var onClick = function (param) {\n    return Belt_Option.forEach(Caml_option.nullable_to_opt(input.current), (function (input) {\n                  input.focus();\n\n                }));\n  };\n  return React.createElement("div", undefined, React.createElement(make, {\n                  className: "fancy",\n                  children: React.createElement("button", {\n                        onClick: onClick\n                      }, "Click to focus"),\n                  ref: input\n                }));\n}\n'))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note:")," Our ",(0,i.kt)("inlineCode",{parentName:"p"},"@react.component")," decorator transforms our labeled argument props within our ",(0,i.kt)("inlineCode",{parentName:"p"},"React.forwardRef")," function in the same manner as our classic ",(0,i.kt)("inlineCode",{parentName:"p"},"make")," function."),(0,i.kt)("p",null,"This way, components using ",(0,i.kt)("inlineCode",{parentName:"p"},"FancyInput")," can get a ref to the underlying ",(0,i.kt)("inlineCode",{parentName:"p"},"input")," DOM node and access it if necessary\u2014just like if they used a DOM ",(0,i.kt)("inlineCode",{parentName:"p"},"input")," directly."),(0,i.kt)("h2",{id:"note-for-component-library-maintainers"},"Note for Component Library Maintainers"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"When you start using ref forwarding in a component library, you should treat it as a breaking change and release a new major version of your library"),". This is because your library likely has an observably different behavior (such as what refs get assigned to, and what types are exported), and this can break apps and other libraries that depend on the old behavior."))}u.isMDXComponent=!0,u.frontmatter={title:"Forwarding Refs",description:"Forwarding Ref values in ReScript and React",canonical:"/docs/react/latest/forwarding-refs",__ghEditHref:"https://github.com/reason-association/rescript-lang.org/blob/master/pages/docs/react/latest/forwarding-refs.mdx"}},22808:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/react/latest/forwarding-refs",function(){return t(63501)}])}},function(e){e.O(0,[49774],(function(){return n=22808,e(e.s=n);var n}));var n=e.O();_N_E=n}]);